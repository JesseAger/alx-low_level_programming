more funtions and nested loops